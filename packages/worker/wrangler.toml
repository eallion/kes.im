#:schema node_modules/wrangler/config-schema.json

# -- Compability
compatibility_date = "2024-07-22"
compatibility_flags = ["nodejs_compat"]

# -- Project configs
account_id = "f6eb193c5ada002251ec96253583e74d"
main = "src/entry.ts"
workers_dev = false
minify = true

# -- Smart placement
[placement]
mode = "smart"

# -- Static files
[site]
bucket = "../site/dist"

####################################################################################################

# -- PRODUCTION --

[env.prod]
name = "kesim"

# -- Routes
routes = [
	{pattern="kes.im", custom_domain=true},
	{pattern="api.kes.im", custom_domain=true},
]

# -- KV Bindings
kv_namespaces = [
  {binding="KV_LINKS", id="767fc2258dd94aa09ddcacdac19b1e23"}
]

# -- D1 Bindings
d1_databases = [
  {binding="D1_LINKS", database_name="kesim", database_id="7356670a-5a76-414d-b8e0-92c30ed0f743" }
]

# -- Limiter Bindings
[[env.prod.unsafe.bindings]]
name = "API_RATE_LIMITER"
type = "ratelimit"
namespace_id = "2000001" # an number identifier, unique to your account
simple = {limit = 3, period = 10} # [limit, # of access per] [period, 10 or 60 (seconds)]

# -- ENV vars
[env.prod.vars]
ENV = "prod"
DEBUG_MODE = true
CFG_SITE_ORIGIN = "https://kes.im"
CFG_SITE_HOSTNAME = "kes.im"
CFG_SITE_API_ORIGIN = "https://api.kes.im"
CFG_SITE_API_HOSTNAME = "api.kes.im"
CFG_RANDOM_SLUG_LENGTH = 5
CFG_MIN_SLUG_LENGTH = 3
CFG_MAX_SLUG_LENGTH = 64
CFG_MIN_URL_LENGTH = 10
CFG_MAX_URL_LENGTH = 2048
CFG_DEFAULT_CACHE_AGE = 3600 # an hour
CFG_DEFAULT_STATIC_CACHE_AGE = 86400 # a day
CFG_HASHED_STATIC_CACHE_AGE = 31536000 # a year
CFG_REDIRECT_CACHE_AGE = 31536000 # a year
CF_STATIC_ASSET_TTL = 172800 # 2 days
CF_KV_CACHE_TTL = 86400 # a day
CF_TURNSTILE_VERIFY_URL = "https://challenges.cloudflare.com/turnstile/v0/siteverify"

####################################################################################################
